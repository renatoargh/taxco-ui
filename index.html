<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Gerenciador de Tarefas</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/gritter.css">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="container"></div>

    <script type="application/javascript" src="/js/jquery.min.js"></script>
    <script type="application/javascript" src="/js/underscore.min.js"></script>
    <script type="application/javascript" src="/js/backbone.min.js"></script>
    <script type="application/javascript" src="/js/modelBinder.min.js"></script>
    <script type="application/javascript" src="/js/deepModel.min.js"></script>
    <script type="application/javascript" src="/js/bootstrap.min.js"></script>
    <script type="application/javascript" src="/js/gritter.min.js"></script>
    <script type="application/javascript" src="/js/moment.min.js"></script>
    <script type="application/javascript" src="/js/momentPtBr.js"></script>
    <script type="application/javascript" src="/js/marked.min.js"></script>

    <script type="text/template" id="logInTemplate">
        <div class="row logotipo">
            <div class="col-sm-12 text-center">
                <img width="200px" height="113px" src="/img/logotipo-bmsilva.png" alt="B. M. Silva Construções Ltda" />
            </div>
        </div>
        <div class="row">
            <div class="email form-group col-sm-offset-4 col-sm-4">
                <label class="control-label" id="emailLabel" for="email">
                    Email
                </label>
                <input class="form-control" type="text" id="email" name="email" placeholder="Email"></input>
                <span class="help-block"></span>
            </div>
        </div>
        <div class="row">
            <div class="password form-group col-sm-offset-4 col-sm-4">
                <label class="control-label" id="passwordLabel" for="password">
                    Senha
                </label>
                <input class="form-control" type="password" id="password" name="password" placeholder="Senha"></input>
                <span class="help-block"></span>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-offset-4 col-sm-4">
                <button id="signUp" class="btn btn-link pull-left">
                    Quero me cadastrar
                </button>
                <button id="login" class="btn btn-success pull-right">
                    ENTRAR&nbsp;
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
            </div>
        </div>

        <div class="modal fade" id="signUpModal" tabindex="-1" role="dialog" aria-labelledby="signUpModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">
                            <span aria-hidden="true">&times;</span>
                            <span class="sr-only">Fechar</span>
                        </button>

                        <h4 class="modal-title" id="signUpModalLabel">
                            <i class="glyphicon glyphicon-user" />&nbsp;
                            Novo Cadastro
                        </h4>
                    </div>

                    <div class="modal-body">
                        <div class="row">
                            <div class="name form-group col-sm-12">
                                <label class="control-label" id="nameLabel" for="name">
                                    Nome
                                </label>
                                <input class="form-control" type="text" id="name" name="name" placeholder="Nome"></input>
                                <span class="help-block"></span>
                            </div>
                            <div class="email form-group col-sm-12">
                                <label class="control-label" id="emailLabel" for="email">
                                    Email
                                </label>
                                <input class="form-control" type="text" id="email" name="email" placeholder="Email"></input>
                                <span class="help-block"></span>
                            </div>
                            <div class="password form-group col-sm-12">
                                <label class="control-label" id="passwordLabel" for="password">
                                    Senha
                                </label>
                                <input class="form-control" type="password" id="password" name="password" placeholder="Senha"></input>
                                <span class="help-block"></span>
                            </div>
                            <div class="passwordConfirmation form-group col-sm-12">
                                <label class="control-label" id="passwordConfirmationLabel" for="passwordConfirmation">
                                    Confirme sua senha
                                </label>
                                <input class="form-control" type="password" id="passwordConfirmation" name="passwordConfirmation" placeholder="Confirme sua senha"></input>
                                <span class="help-block"></span>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                        <button id="sendSignUpForm" type="button" class="btn btn-primary">Enviar</button>
                    </div>
                </div>
            </div>
        </div>
    </script>

    <script type="text/template" id="listTasksTemplate">
        <div class="row logotipo">
            <div class="col-sm-12 text-center">
                <img width="200px" height="113px" src="/img/logotipo-bmsilva.png" alt="B. M. Silva Construções Ltda" />
            </div>
        </div>
        <div class="row formActions">
            <div class="col-sm-offset-3 col-sm-6">
                <button id="newTask" class="btn btn-primary btn-sm pull-left">
                    Nova Tarefa&nbsp;
                    <i class="glyphicon glyphicon-plus"></i>
                </button>
                <button id="listUsers" class="btn btn-primary btn-sm pull-left">
                    Usuários&nbsp;
                    <i class="glyphicon glyphicon-user"></i>
                </button>
                <div class="dropdown pull-right">
                  <button class="btn btn-primary btn-sm dropdown-toggle" type="button" id="filter" data-toggle="dropdown">
                    <i class="glyphicon glyphicon-filter"></i>&nbsp;
                    Filtrar&nbsp;
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="filter">
                    <li role="presentation">
                        <a role="menuitem" tabindex="-1" href="#">
                            <i class="glyphicon glyphicon-ok" />&nbsp;
                            Criadas por mim
                        </a>
                    </li>
                    <li role="presentation">
                        <a role="menuitem" tabindex="-1" href="#">
                            <i class="glyphicon glyphicon-ok" />&nbsp;
                            Atribuidas a mim
                        </a>
                    </li>
                    <li role="presentation">
                        <a role="menuitem" tabindex="-1" href="#">
                            <i class="glyphicon glyphicon-ok" />&nbsp;
                            Abertas
                        </a>
                    </li>
                    <li role="presentation">
                        <a role="menuitem" tabindex="-1" href="#">
                            <i class="glyphicon glyphicon-ok" />&nbsp;
                            Fechadas
                        </a>
                    </li>
                  </ul>
                </div>
            </div>
        </div>
        <div class="row" id="tasks"></div>
        <div class="modal fade" id="newTaskModal" tabindex="-1" role="dialog" aria-labelledby="newTaskModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">
                            <span aria-hidden="true">&times;</span>
                            <span class="sr-only">Fechar</span>
                        </button>

                        <h4 class="modal-title" id="newTaskModalLabel">
                            <i class="glyphicon glyphicon-file"></i>&nbsp;
                            Nova Tarefa
                        </h4>
                    </div>

                    <div class="modal-body">
                        <div class="edit">
                            <div class="row">
                                <div class="title form-group col-sm-12">
                                    <label class="control-label" id="titleLabel" for="title">
                                        Título
                                    </label>
                                    <input class="form-control" type="text" id="title" name="title" placeholder="Título"></input>
                                </div>
                                <div class="description form-group col-sm-12">
                                    <label class="control-label" id="descriptionLabel" for="description">
                                        Descrição
                                    </label>
                                    <textarea name="description" id="description" cols="30" rows="10" class="form-control" placeholder="Descrição"></textarea>
                                </div>

                                <div class="assignedTo form-group col-sm-6">
                                    <label class="control-label" id="assignedToLabel" for="assignedTo">
                                        Atribuído A
                                    </label>
                                    <select class="form-control" id="assignedTo" name="assignedToId"></select>
                                </div>
                                <div class="visibleTo form-group col-sm-6">
                                    <label class="control-label" id="visibleToLabel" for="visibleTo">
                                        Visível Para
                                    </label>
                                    <select class="form-control" id="visibleTo" name="visibleToId" multiple></select>
                                </div>
                            </div>
                        </div>
                        <div class="visualize">
                            <h4 id="taskTitle"></h4>
                            <span id="taskDescription"></span>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button id="visualizeNewTask" type="button" class="btn btn-default pull-left">Visualizar</button>
                        <button id="editNewTask" type="button" class="displayNone btn btn-default pull-left">Editar</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                        <button id="saveTask" type="button" class="btn btn-primary">Salvar</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="listUsersModal" tabindex="-1" role="dialog" aria-labelledby="listUsersModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">
                            <span aria-hidden="true">&times;</span>
                            <span class="sr-only">Fechar</span>
                        </button>

                        <h4 class="modal-title" id="listUsersModalLabel">
                            <i class="glyphicon glyphicon-user"></i>
                            Usuários
                        </h4>
                    </div>

                    <div class="modal-body">
                        <table id="users" class="table table-striped table-hover table-condensed">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Email</th>
                                    <th>Perfil</th>
                                    <th>Habilitado</th>
                                    <th>Última Interação</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div class="modal-footer">
                        <span id="savingUser" class="pull-left">
                            Salvando...
                        </span>
                        <button type="button" class="btn btn-primary" data-dismiss="modal">Ok</button>
                    </div>
                </div>
            </div>
        </div>
    </script>

    <script type="text/template" id="userTemplate">
        <td width="27%" class="name">
            <span class="visualize name"></span>
            <input type="text" width="100%" maxlength="75" class="edit name"></input>
        </td>
        <td width="27%" class="email">
            <span class="email visualize"></span>
            <input type="text" width="100%" maxlength="50" class="email edit"></input>
        </td>
        <td width="15%" class="role">
            <span class="role visualize"></span>
            <select class="role edit">
                <option value="user">Usuário</option>
                <option value="admin">Administrador</option>
            </select>
        </td>
        <td width="10%" class="enabled">
            <span class="enabled visualize"></span>
            <select class="enabled edit">
                <option value="true">SIM</option>
                <option value="false">NÃO</option>
            </select>
        </td>
        <td width="21%" class="lastInteraction">
            <span class="lastInteraction visualize"></span>
            <button class="save edit btn btn-xs btn-primary">
                Salvar&nbsp;
                <i class="glyphicon glyphicon-floppy-disk" />
            </button>
        </td>
    </script>
    <script type="text/template" id="taskTemplate">
        <div class="task col-sm-offset-3 col-sm-6">
            <h4 class="taskToggler">
                <i class="glyphicon glyphicon-chevron-right"></i>&nbsp;
                <span class="title"></span>&nbsp;
                <span class="isOpen"></span>
            </h4>
            <span class="details hidden">
                <div class="description"></div>
                <small class="text-muted">
                    Criado por
                    <span class="owner text-muted"></span>
                    em
                    <span class="createdAt"></span>
                    (<span class="createdAtFromNow"></span>)
                </small>
                <div class="actions">
                    <button class="btn btn-xs btn-primary pull-left">
                        Editar&nbsp;
                        <i class="glyphicon glyphicon-pencil"></i>
                    </button>
                    <button class="btn btn-xs btn-primary pull-left">
                        Comentar&nbsp;
                        <i class="glyphicon glyphicon-comment"></i>
                    </button>
                    <button class="btn btn-xs btn-danger pull-right">
                        Apagar&nbsp;
                        <i class="glyphicon glyphicon-trash"></i>
                    </button>
                    <br style="clear: both;" />
                </div>
            </span>
        </div>
    </script>

    <script>
    $(function() {
        var baseUrl = 'http://localhost:9090';

        function showMessage(params) {
            return $.gritter.add({
                title: params.title || '',
                text: params.text || '',
                time: 3000,
                class_name: {
                    info: 'gritter-info',
                    error: 'gritter-error',
                    success: 'gritter-success',
                }[params.type || 'info']
            });
        }

        function getCurrentUser() {
            var currentUser = localStorage.getItem('currentUser');
            return currentUser ? JSON.parse(currentUser) : null;
        }

        function setCurrentUser(user) {
            var currentUser = JSON.stringify(user);
            localStorage.setItem('currentUser', currentUser);
        }

        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                var user = getCurrentUser(),
                    isTaxcoRequest = settings.url.indexOf(baseUrl) === 0;

                if(isTaxcoRequest && user && user.credentials) {
                    xhr.setRequestHeader("Authorization", user.credentials);
                }
            }
        });

        var LogInView = Backbone.View.extend({
            initialize: function() {
                this.model = new Backbone.Model();
                this.modelBinder = new Backbone.ModelBinder();
            },
            template: _.template($('#logInTemplate').html()),
            el: '.container',
            render: function() {
                this.$el.html(this.template());
                this.modelBinder.bind(this.model, this.el);
            },

            events: {
                'click button#login': 'login',
                'click button#signUp': 'signUp',
                'click button#sendSignUpForm': 'sendSignUpForm'
            },

            login: function() {
                var user = this.model,
                    credentials = 'Basic ' + btoa([
                        user.get('email'),
                        user.get('password')
                    ].join(':'));

                setCurrentUser(null);

                var get = $.ajax({
                    type: 'GET',
                    url: baseUrl + '/users/me',
                    beforeSend: function(request) {
                        request.setRequestHeader("Authorization", credentials);
                    }
                });

                get.done(function(user) {
                    user.credentials = credentials;
                    setCurrentUser(user);

                    router.navigate('/tasks', {
                        trigger: true
                    });
                });

                get.fail(function() {
                    showMessage({
                        type: 'error',
                        title: 'Erro',
                        text: [
                            'Email ou senha não encontrados.',
                            'O seu acesso só estará disponível após liberação pelo moderador.'
                        ].join(' ')
                    });
                });
            },

            signUp: function(e) {
                $('#signUpModal').modal('show');
            },

            sendSignUpForm: function(e) {
                var $signUpModal = $('#signUpModal'),
                    _this = this;

                setCurrentUser(null);

                if(this.model.get('password') !== this.model.get('passwordConfirmation')) {
                    return showMessage({
                        type: 'error',
                        text: 'As senhas não coincidem'
                    });
                }

                var post = $.ajax({
                    type: 'POST',
                    url: baseUrl + '/users',
                    data: _.pick(this.model.attributes, 'name', 'email', 'password')
                });

                post.done(function() {
                    $signUpModal.modal('hide');

                    _this.model.set({
                        id: null,
                        name: '',
                        email: '',
                        password: '',
                        passwordConfirmation: ''
                    });

                    showMessage({
                        type: 'success',
                        title: 'Sucesso',
                        text: [
                            'Seu cadastro foi recebido e será analisado.',
                            'Em breve você receberá um email com instruções de login.'
                        ].join(' ')
                    });
                });

                post.fail(function() {
                    showMessage({
                        type: 'error',
                        title: 'Erro',
                        text: 'Algo deu errado'
                    });
                })
            },
        });

        var TaskView = Backbone.View.extend({
            initialize: function(task) {
                this.model = new Backbone.DeepModel(task);
                this.modelBinder = new Backbone.ModelBinder();
            },
            template: _.template($('#taskTemplate').html()),
            render: function(container) {
                var taskContainer = $('<div />'),
                    _this = this;

                this.setElement(taskContainer);
                taskContainer.html(this.template());
                container.append(taskContainer);
                this.modelBinder.bind(this.model, this.el, {
                    title: {
                        selector: '.title',
                        elAtributte: 'html'
                    },
                    isOpen: [{
                        selector: '.isOpen',
                        elAttribute: 'class',
                        converter: function(direction, value) {
                            return value ? 'label label-danger' : 'label label-success';
                        }
                    }, {
                        selector: '.isOpen',
                        elAttribute: 'html',
                        converter: function(direction, value) {
                            return value ? 'Aberto' : 'Fechado';
                        }
                    }],
                    'owner.name': {
                        selector: '.owner',
                        elAtributte: 'html'
                    },
                    description: {
                        selector: '.description',
                        elAttribute: 'html',
                        converter: function(direction, value) {
                            return marked(value);
                        }
                    },
                    createdAt: [{
                        selector: '.createdAt',
                        elAttribute: 'html',
                        converter: function(direction, value) {
                            return new moment(value).format('L HH:mm');
                        }
                    }, {
                        selector: '.createdAtFromNow',
                        elAttribute: 'html',
                        converter: function(direction, value) {
                            return new moment(value).fromNow();
                        }
                    }]
                });
            },

            events: {
                'click .taskToggler': 'toggleTaskDetails'
            },

            areDetailsHidden: true,

            toggleTaskDetails: function() {
                var $details = this.$el.find('.details'),
                    $icon = this.$el.find('.taskToggler i.glyphicon');

                $details.toggleClass('hidden', !this.areDetailsHidden);
                $icon.toggleClass('glyphicon-chevron-right', !this.areDetailsHidden);

                $details.toggleClass('show', this.areDetailsHidden);
                $icon.toggleClass('glyphicon-chevron-down', this.areDetailsHidden);

                this.areDetailsHidden = !this.areDetailsHidden;
            }
        });

        var UserView = Backbone.View.extend({
            initialize: function(user) {
                this.model = new Backbone.Model(user);
                this.modelBinder = new Backbone.ModelBinder();
            },
            template: _.template($('#userTemplate').html()),
            render: function() {
                var rootElement = $('<tr class="user"/>');
                rootElement.one('click', this.toggleMode.bind(this));

                this.setElement(rootElement);
                this.$el.html(this.template());
                $('table#users tbody').append(this.$el);

                this.modelBinder.bind(this.model, this.el, {
                    name: [{
                        selector: '.visualize.name',
                        elAtributte: 'html',
                        converter: function(direction, value) {
                            return value;
                        }
                    }, {
                        selector: '.edit.name',
                        converter: function(direction, value) {
                            if(direction === 'ModelToView') {
                                return value || '';
                            } else {
                                return value.trim();
                            }
                        }
                    }],
                    email: [{
                        selector: '.visualize.email',
                        elAtributte: 'html',
                        converter: function(direction, value) {
                            return value;
                        }
                    }, {
                        selector: '.edit.email',
                        converter: function(direction, value) {
                            if(direction === 'ModelToView') {
                                return value || '';
                            } else {
                                return value.trim();
                            }
                        }
                    }],
                    enabled: [{
                        selector: '.visualize.enabled',
                        elAtributte: 'html',
                        converter: function(direction, value) {
                            if(direction === 'ModelToView') {
                                return value ? 'SIM' : 'NÃO'
                            }
                        }
                    }, {
                        selector: '.edit.enabled',
                        converter: function(direction, value) {
                            if(direction === 'ModelToView') {
                                if(typeof value === 'undefined' || value === null) {
                                    return 'false';
                                }

                                return value.toString();
                            } else {
                                return value === 'true';
                            }
                        }
                    }],
                    role: [{
                        selector: '.visualize.role',
                        elAtributte: 'html',
                        converter: function(direction, value) {
                            if(direction === 'ModelToView') {
                                return {
                                    'admin': 'Administrador',
                                    'user': 'Usuário'
                                }[value];
                            } else {
                                return value;
                            }
                        }
                    }, {
                        selector: '.edit.role',
                        converter: function(direction, value) {
                            if(direction === 'ModelToView') {
                                if(!value) {
                                    return 'user';
                                }

                                return value;
                            } else {
                                return value;
                            }
                        }
                    }],
                    lastInteraction: {
                        selector: 'span.lastInteraction',
                        elAtributte: 'html',
                        converter: function(direction, value) {
                            if(!value) {
                                return;
                            }

                            return new moment(value).format('L HH:mm:ss');
                        }
                    }
                });
            },

            events: {
                'click button.save': 'saveUser'
            },

            saveUser: function(e) {
                var _this = this,
                    $savingUser = $('#savingUser');

                $savingUser.show();

                var put = $.ajax({
                    url: baseUrl + '/users/' + this.model.get('id'),
                    type: 'PUT',
                    data: this.model.attributes
                });

                put.done(function() {
                    $savingUser.hide();
                    _this.toggleMode();
                    _this.$el.one('click', _this.toggleMode.bind(_this));
                });

                put.fail(function() {
                    showMessage({
                        type: 'error',
                        title: 'Erro',
                        text: 'Ocorreu algum problema ao salvar as alterações no usuário'
                    });
                });
            },

            currentMode: 'visualize',
            toggleMode: function(e) {
                if(this.currentMode === 'visualize') {
                    this.$el.find('.edit').show();
                    this.$el.find('.visualize').hide();
                    this.currentMode = 'edit';
                } else {
                    this.$el.find('.edit').hide();
                    this.$el.find('.visualize').show();
                    this.currentMode = 'visualize';
                }
            },
        });

        var ListTasksView = Backbone.View.extend({
            initialize: function() {
                this.model = new Backbone.Model();
                this.modelBinder = new Backbone.ModelBinder();
            },
            template: _.template($('#listTasksTemplate').html()),
            el: '.container',
            _render: function(tasks) {
                var _this = this;
                this.$el.html(this.template());

                tasks.forEach(function(task) {
                    var taskView = new TaskView(task);
                    taskView.render(_this.$el.find('#tasks'));
                });

                this.modelBinder.bind(this.model, this.el);
            },
            render: function() {
                var _this = this,
                    get = $.getJSON(baseUrl + '/tasks');

                get.done(function(tasks) {
                    _this._render(tasks);
                });

                get.fail(function(err) {
                    showMessage({
                        type: 'error',
                        title: 'Erro',
                        text: 'Algo deu errado...'
                    });
                });
            },

            events: {
                'click button#listUsers': 'listUsers',
                'click button#newTask': 'newTask',
                'click #newTaskModal .modal-footer #visualizeNewTask': 'visualizeNewTask',
                'click #newTaskModal .modal-footer #editNewTask': 'editNewTask',
                'click #newTaskModal .modal-footer #saveTask': 'saveTask'
            },

            saveTask: function(e) {
                console.log(JSON.stringify(this.model, null, 4));

                var _this = this,
                    post = $.ajax({
                        url: baseUrl + '/tasks',
                        type: 'POST',
                        data: _.pick(this.model.attributes, [
                            'title',
                            'description',
                            'assignedToId',
                            'visibleToId'
                        ])
                    });

                post.done(function() {
                    var $newTask = _this.$el.find('#newTaskModal');
                    $newTask.modal('hide');

                    showMessage({
                        type: 'success',
                        title: 'Sucesso',
                        text: 'Tarefa salva!'
                    });
                });

                post.fail(function() {
                    showMessage({
                        type: 'error',
                        title: 'Erro',
                        text: 'Algo deu errado...'
                    });
                });
            },

            editNewTask: function(e) {
                $('#newTaskModal .modal-body .edit').show();
                $('#newTaskModal .modal-footer #visualizeNewTask').show();

                $('#newTaskModal .modal-body .visualize').hide();
                $('#newTaskModal .modal-footer #editNewTask').hide();
            },

            visualizeNewTask: function(e) {
                var title = this.model.get('title'),
                    description = this.model.get('description');

                $('#newTaskModal .modal-body #taskTitle').html(title);
                $('#newTaskModal .modal-body #taskDescription').html(marked(description || ''));

                $('#newTaskModal .modal-body .edit').hide();
                $('#newTaskModal .modal-footer #visualizeNewTask').hide();

                $('#newTaskModal .modal-body .visualize').show();
                $('#newTaskModal .modal-footer #editNewTask').show();
            },

            newTask: function(e) {
                var _this = this,
                    get = $.getJSON(baseUrl + '/users?enabled=true');

                get.done(function(users) {
                    var $newTask = _this.$el.find('#newTaskModal'),
                        $assignedTo = $newTask.find('select#assignedTo'),
                        $visibleTo = $newTask.find('select#visibleTo');

                    $assignedTo.html('');
                    $visibleTo.html('');

                    users.forEach(function(user) {
                        $assignedTo.append($('<option />').val(user.id).html(user.name));
                        $visibleTo.append($('<option />').val(user.id).html(user.name));
                    });

                    $assignedTo.prepend($('<option />').html('NINGUÉM'));
                    $visibleTo.prepend($('<option />').val('ALL').html('TODOS'));

                    $newTask.modal('show');
                });

                get.fail(function() {
                    showMessage({
                        type: 'error',
                        title: 'Erro',
                        text: 'Algo deu errado...'
                    });
                });
            },

            listUsers: function(e) {
                var get = $.getJSON(baseUrl + '/users');

                get.done(function(users) {
                    $('table#users tbody').empty();

                    users.forEach(function(user) {
                        var userView = new UserView(user);
                        userView.render();
                    });

                    var $listUsersModel = $('#listUsersModal');
                    $listUsersModel.modal('show');
                });

                get.fail(function() {
                    showMessage({
                        type: 'error',
                        title: 'Erro',
                        text: 'Algo deu errado...'
                    });
                });
            },
        });

        var Router = Backbone.Router.extend({
                routes: {
                    '': 'logIn' ,
                    'tasks': 'listTasks',
                    'tasks/:id': 'showTask'
                }
            }),
            router = new Router();

        router.on('route:logIn', function() {
            var view = new LogInView();
            view.render();
        });

        router.on('route:listTasks', function() {
            var view = new ListTasksView();
            view.render();
        });

        Backbone.history.start();
    });
    </script>
</body>
</html>